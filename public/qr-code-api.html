<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive QR Code API Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            color: #212529;
            margin: 0;
            padding: 2rem;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 1000px;
            width: 100%;
        }
        h1, h2 {
            font-weight: 700;
            color: #343a40;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: 1.1rem;
            color: #6c757d;
            margin-bottom: 3rem;
        }
        .builder-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .form-container {
            flex: 1;
            min-width: 300px;
        }
        .result-container {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 1.5rem;
        }
        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            color: #6c757d;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
        }
        .tab.active {
            color: #0d6efd;
            border-bottom-color: #0d6efd;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        input[type="text"], input[type="url"], input[type="tel"], input[type="email"], input[type="number"], select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        .color-picker-wrapper {
            display: flex;
            align-items: center;
        }
        input[type="color"] {
            margin-right: 0.5rem;
            width: 40px;
            height: 40px;
            padding: 0.2rem;
            border-radius: 4px;
        }
        .advanced-options-toggle {
            color: #0d6efd;
            cursor: pointer;
            font-weight: 500;
            margin-top: 1.5rem;
            display: inline-block;
        }
        .advanced-options {
            display: none;
            margin-top: 1rem;
        }
        #qr-code-img {
            max-width: 100%;
            height: auto;
            border: 1px solid #dee2e6;
            padding: 1rem;
            border-radius: 8px;
        }
        #qr-code-url {
            word-wrap: break-word;
            font-family: monospace;
            background: #e9ecef;
            padding: 0.75rem;
            border-radius: 4px;
            margin-top: 1rem;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Build your own QR code</h1>
        <p class="subtitle">Use the interactive editor below to generate a QR code image URL for your app, email, or other project.</p>

        <div class="builder-wrapper">
            <div class="form-container">
                <div class="tabs">
                    <button class="tab active" data-tab="text">Text/URL</button>
                    <button class="tab" data-tab="wifi">WiFi</button>
                    <button class="tab" data-tab="vcard">vCard</button>
                    <button class="tab" data-tab="phone">Phone</button>
                    <button class="tab" data-tab="email">Email</button>
                    <button class="tab" data-tab="sms">SMS</button>
                    <button class="tab" data-tab="location">Location</button>
                </div>

                <div id="text-tab" class="tab-content active">
                    <div class="form-group">
                        <label for="text-data">QR data (text or URL)</label>
                        <textarea id="text-data">Hello world</textarea>
                    </div>
                </div>

                <div id="wifi-tab" class="tab-content">
                    <div class="form-group">
                        <label for="wifi-ssid">Network Name (SSID)</label>
                        <input type="text" id="wifi-ssid" placeholder="MyWiFiNetwork">
                    </div>
                    <div class="form-group">
                        <label for="wifi-password">Password</label>
                        <input type="text" id="wifi-password" placeholder="MyPassword">
                    </div>
                    <div class="form-group">
                        <label for="wifi-encryption">Encryption</label>
                        <select id="wifi-encryption">
                            <option value="WPA">WPA/WPA2</option>
                            <option value="WEP">WEP</option>
                            <option value="">None</option>
                        </select>
                    </div>
                </div>
                
                <div id="vcard-tab" class="tab-content">
                    <div class="form-group"><label for="vcard-name">Name</label><input type="text" id="vcard-name" placeholder="John Doe"></div>
                    <div class="form-group"><label for="vcard-phone">Phone</label><input type="tel" id="vcard-phone" placeholder="+15551234567"></div>
                    <div class="form-group"><label for="vcard-email">Email</label><input type="email" id="vcard-email" placeholder="john.doe@example.com"></div>
                    <div class="form-group"><label for="vcard-url">Website</label><input type="url" id="vcard-url" placeholder="https://example.com"></div>
                    <div class="form-group"><label for="vcard-org">Organization</label><input type="text" id="vcard-org" placeholder="ACME Inc."></div>
                    <div class="form-group"><label for="vcard-title">Title</label><input type="text" id="vcard-title" placeholder="Software Engineer"></div>
                </div>

                <div id="phone-tab" class="tab-content">
                    <div class="form-group"><label for="phone-number">Phone Number</label><input type="tel" id="phone-number" placeholder="+15551234567"></div>
                </div>

                <div id="email-tab" class="tab-content">
                    <div class="form-group"><label for="email-to">To Email</label><input type="email" id="email-to" placeholder="recipient@example.com"></div>
                    <div class="form-group"><label for="email-subject">Subject</label><input type="text" id="email-subject" placeholder="Hello!"></div>
                    <div class="form-group"><label for="email-body">Body</label><textarea id="email-body" placeholder="Just wanted to say hi."></textarea></div>
                </div>

                <div id="sms-tab" class="tab-content">
                    <div class="form-group"><label for="sms-to">To Phone Number</label><input type="tel" id="sms-to" placeholder="+15551234567"></div>
                    <div class="form-group"><label for="sms-body">Message</label><textarea id="sms-body" placeholder="Hi there!"></textarea></div>
                </div>

                <div id="location-tab" class="tab-content">
                    <div class="form-group"><label for="location-lat">Latitude</label><input type="text" id="location-lat" placeholder="40.7128"></div>
                    <div class="form-group"><label for="location-lon">Longitude</label><input type="text" id="location-lon" placeholder="-74.0060"></div>
                </div>

                <hr style="border: 1px solid #f1f3f5; margin: 1.5rem 0;">

                <div class="form-group">
                    <label for="size">Size (px)</label>
                    <input type="number" id="size" value="200">
                </div>
                <div class="form-group">
                    <label for="margin">Margin (blocks)</label>
                    <input type="number" id="margin" value="4">
                </div>
                <div class="form-group">
                    <label for="dark">Color (foreground)</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="dark-picker" value="#000000">
                        <input type="text" id="dark" value="000000">
                    </div>
                </div>
                <div class="form-group">
                    <label for="light">Color (background)</label>
                    <div class="color-picker-wrapper">
                        <input type="color" id="light-picker" value="#ffffff">
                        <input type="text" id="light" value="ffffff">
                    </div>
                </div>
                
                <div class="advanced-options-toggle" id="advanced-toggle">▼ Advanced options</div>
                <div class="advanced-options" id="advanced-options">
                    <div class="form-group">
                        <label for="ecLevel">Error correction</label>
                        <select id="ecLevel">
                            <option value="L">Low</option>
                            <option value="M" selected>Medium</option>
                            <option value="Q">Quartile</option>
                            <option value="H">High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="format">Format</label>
                        <select id="format">
                            <option value="png">PNG</option>
                            <option value="svg">SVG</option>
                        </select>
                    </div>
                </div>

            </div>
            <div class="result-container">
                <img id="qr-code-img" src="/qr?text=Hello%20world&size=200">
                <div id="qr-code-url">/qr?text=Hello%20world&size=200</div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const inputs = document.querySelectorAll('input, select, textarea');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const qrImg = document.getElementById('qr-code-img');
            const qrUrl = document.getElementById('qr-code-url');
            const darkPicker = document.getElementById('dark-picker');
            const darkInput = document.getElementById('dark');
            const lightPicker = document.getElementById('light-picker');
            const lightInput = document.getElementById('light');
            const advancedToggle = document.getElementById('advanced-toggle');
            const advancedOptions = document.getElementById('advanced-options');

            // This line is now a placeholder that the server will replace.
            const apiKey = '';

            function updateQrCode() {
                const params = new URLSearchParams();
                let text = '';

                const activeTab = document.querySelector('.tab.active').dataset.tab;

                if (activeTab === 'text') {
                    text = document.getElementById('text-data').value;
                } else if (activeTab === 'wifi') {
                    const ssid = document.getElementById('wifi-ssid').value;
                    const password = document.getElementById('wifi-password').value;
                    const encryption = document.getElementById('wifi-encryption').value;
                    text = `WIFI:T:${encryption};S:${ssid};P:${password};;`;
                } else if (activeTab === 'vcard') {
                    const name = document.getElementById('vcard-name').value;
                    const phone = document.getElementById('vcard-phone').value;
                    const email = document.getElementById('vcard-email').value;
                    const url = document.getElementById('vcard-url').value;
                    const org = document.getElementById('vcard-org').value;
                    const title = document.getElementById('vcard-title').value;
                    text = `BEGIN:VCARD\nVERSION:3.0\nN:${name}\nORG:${org}\nTITLE:${title}\nTEL:${phone}\nEMAIL:${email}\nURL:${url}\nEND:VCARD`;
                } else if (activeTab === 'phone') {
                    text = `tel:${document.getElementById('phone-number').value}`;
                } else if (activeTab === 'email') {
                    const to = document.getElementById('email-to').value;
                    const subject = document.getElementById('email-subject').value;
                    const body = document.getElementById('email-body').value;
                    text = `mailto:${to}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                } else if (activeTab === 'sms') {
                    const to = document.getElementById('sms-to').value;
                    const body = document.getElementById('sms-body').value;
                    text = `smsto:${to}:${encodeURIComponent(body)}`;
                } else if (activeTab === 'location') {
                    const lat = document.getElementById('location-lat').value;
                    const lon = document.getElementById('location-lon').value;
                    text = `geo:${lat},${lon}`;
                }

                params.append('text', text);

                if (document.getElementById('size').value) params.append('size', document.getElementById('size').value);
                if (document.getElementById('margin').value) params.append('margin', document.getElementById('margin').value);
                if (darkInput.value) params.append('dark', darkInput.value.replace('#', ''));
                if (lightInput.value) params.append('light', lightInput.value.replace('#', ''));
                if (document.getElementById('ecLevel').value) params.append('ecLevel', document.getElementById('ecLevel').value);
                if (document.getElementById('format').value) params.append('format', document.getElementById('format').value);
                
                // Append the API key to every QR code image request if it exists
                if (apiKey) {
                    params.append('key', apiKey);
                }

                const newUrl = `/qr?${params.toString()}`;
                qrImg.src = newUrl;
                qrUrl.textContent = newUrl;
            }

            inputs.forEach(input => {
                input.addEventListener('input', updateQrCode);
            });

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
                    updateQrCode();
                });
            });

            darkPicker.addEventListener('input', (e) => {
                darkInput.value = e.target.value.substring(1);
                updateQrCode();
            });
            darkInput.addEventListener('input', (e) => {
                darkPicker.value = '#' + e.target.value;
                updateQrCode();
            });

            lightPicker.addEventListener('input', (e) => {
                lightInput.value = e.target.value.substring(1);
                updateQrCode();
            });
            lightInput.addEventListener('input', (e) => {
                lightPicker.value = '#' + e.target.value;
                updateQrCode();
            });

            advancedToggle.addEventListener('click', () => {
                if (advancedOptions.style.display === 'none' || advancedOptions.style.display === '') {
                    advancedOptions.style.display = 'block';
                    advancedToggle.textContent = '▲ Advanced options';
                } else {
                    advancedOptions.style.display = 'none';
                    advancedToggle.textContent = '▼ Advanced options';
                }
            });

            // Initial call
            updateQrCode();
        });
    </script>
</body>
</html>

